# üîÑ Odoo 17 ‚Üí 18

## üéØ Vue d'ensemble des changements majeurs

### 1. **Vues et interface**
- **tree ‚Üí list** : Remplacement du type de vue `tree` par `list`
- **Chatter** : Simplification de `<div class="oe_chatter">` vers `<chatter />`
- **Champs invisibles** : Auto-ajout des champs utilis√©s dans les domaines

### 2. **M√©thodes Python**
- **user_has_groups** : Remplac√© par `self.env.user.has_group`
- **M√©thodes d'acc√®s** : `check_access_rights()` ‚Üí `check_access()`
- **Recherche** : `_name_search` ‚Üí `_search_display_name`
- **R√©cursion** : `_check_recursion()` ‚Üí `_has_cycle()`

### 3. **ORM et champs**
- **Tuples d√©pr√©ci√©s** : Les tuples de manipulation de relations sont remplac√©s par `Command`
- **Copie** : `copy` et `copy_data` supportent maintenant les multi-recordsets
- **Agr√©gation** : `group_operator` ‚Üí `aggregator`

### 4. **JavaScript/OWL**
- **Super calls** : `this._super()` remplac√© par `super.methodName()`
- **Modules** : `/** @odoo-module **/` peut √™tre supprim√©
- **Registry** : Nouvel import pour `Registry`

### 5. **Crons (T√¢ches planifi√©es)**
- **Suppression** : Les champs `numbercall` et `doall` ont √©t√© supprim√©s du mod√®le `ir.cron`

## üìã Checklist de migration d√©taill√©e Odoo 17 ‚Üí 18

### ‚úÖ 1. Vues - tree ‚Üí list

**Probl√®me** : Le type de vue `tree` est remplac√© par `list`

```xml
<!-- AVANT (Odoo 17) -->
<record id="view_name" model="ir.ui.view">
    <field name="arch" type="xml">
        <tree>
            <field name="name"/>
        </tree>
    </field>
</record>

<!-- APR√àS (Odoo 18) -->
<record id="view_name" model="ir.ui.view">
    <field name="arch" type="xml">
        <list>
            <field name="name"/>
        </list>
    </field>
</record>
```

```python
# AVANT (Odoo 17)
action = {
    'view_mode': 'tree,form',
    'view_type': 'tree',
}

# APR√àS (Odoo 18)
action = {
    'view_mode': 'list,form',
    'view_type': 'list',
}
```

### ‚úÖ 2. user_has_groups ‚Üí self.env.user.has_group

**Probl√®me** : `user_has_groups` est supprim√©

```python
# AVANT (Odoo 17)
from odoo.http import request
if request.env.user.user_has_groups('base.group_user'):
    # code

# APR√àS (Odoo 18)
if self.env.user.has_group('base.group_user'):
    # code
```

### ‚úÖ 3. M√©thodes d'acc√®s - check_access_rights() ‚Üí check_access()

**Probl√®me** : Consolidation des m√©thodes d'acc√®s

```python
# AVANT (Odoo 17)
self.check_access_rights('read')
self.check_access_rule('read')
filtered_records = records._filter_access_rule('read')
filtered_records = records._filter_access_rule_python('read')

# APR√àS (Odoo 18)
self.check_access('read')
filtered_records = records._filter_access('read')
```

### ‚úÖ 4. _name_search ‚Üí _search_display_name

**Probl√®me** : M√©thode de recherche remplac√©e

```python
# AVANT (Odoo 17)
@api.model
def _name_search(self, name='', args=None, operator='ilike', limit=100, name_get_uid=None):
    return super()._name_search(name, args, operator, limit, name_get_uid)

# APR√àS (Odoo 18)
@api.model
def _search_display_name(self, operator, value):
    return super()._search_display_name(operator, value)
```

### ‚úÖ 5. _check_recursion() ‚Üí _has_cycle()

**Probl√®me** : M√©thode de v√©rification de r√©cursion remplac√©e

```python
# AVANT (Odoo 17)
if not self._check_recursion():
    raise ValidationError("Recursion detected")

# APR√àS (Odoo 18)
if self._has_cycle():
    raise ValidationError("Cycle detected")
```

### ‚úÖ 6. copy et copy_data - Support multi-recordsets

**Probl√®me** : Ces m√©thodes supportent maintenant les multi-recordsets

```python
# AVANT (Odoo 17)
def copy_data(self, default=None):
    data = super().copy_data(default)
    # data est un dict
    return data

# APR√àS (Odoo 18)
def copy_data(self, default=None):
    data_list = super().copy_data(default)
    # data_list est une liste de dicts
    for data in data_list:
        # traitement de chaque dict
    return data_list
```

### ‚úÖ 7. group_operator ‚Üí aggregator

**Probl√®me** : Attribut de champ renomm√©

```python
# AVANT (Odoo 17)
amount = fields.Float(group_operator='sum')

# APR√àS (Odoo 18)
amount = fields.Float(aggregator='sum')
```

### ‚úÖ 8. Chatter simplifi√©

**Probl√®me** : Structure du chatter simplifi√©e

```xml
<!-- AVANT (Odoo 17) -->
<div class="oe_chatter">
    <field name="message_follower_ids"/>
    <field name="activity_ids"/>
    <field name="message_ids"/>
</div>

<!-- APR√àS (Odoo 18) -->
<chatter />
```

### ‚úÖ 9. Registry - Nouvel import

**Probl√®me** : Import de registry modifi√©

```python
# AVANT (Odoo 17)
from odoo import registry
reg = registry(db_name)

# APR√àS (Odoo 18)
from odoo.modules.registry import Registry
reg = Registry(db_name)
```

### ‚úÖ 10. JavaScript - Suppression /** @odoo-module **/

**Probl√®me** : Commentaire de module obsol√®te

```javascript
// AVANT (Odoo 17)
/** @odoo-module **/

import { Component } from "@odoo/owl";

// APR√àS (Odoo 18)
import { Component } from "@odoo/owl";
```

### ‚úÖ 11. Tests - extra_trigger supprim√©

**Probl√®me** : `extra_trigger` n'est plus support√© dans les tours de test

```javascript
// AVANT (Odoo 17)
{
    trigger: '.button',
    extra_trigger: '.other_element',
    run: 'click',
}

// APR√àS (Odoo 18)
{
    trigger: '.other_element',
}, {
    trigger: '.button',
    run: 'click',
}
```

### ‚úÖ 12. Crons (ir.cron) - Suppression de champs

**Probl√®me** : Champs supprim√©s dans Odoo 18

```xml
<!-- AVANT (Odoo 17) -->
<field name="numbercall">-1</field>
<field eval="False" name="doall"/>

<!-- APR√àS (Odoo 18) -->
<!-- Ces champs doivent √™tre supprim√©s -->
```

### ‚úÖ 13. Syntaxe ORM - Tuples d√©pr√©ci√©s

**Probl√®me** : Les tuples de manipulation de relations sont d√©pr√©ci√©s

```python
# AVANT (Odoo 17)
'line_ids': [(5, 0, 0), (0, 0, vals)]

# APR√àS (Odoo 18)
from odoo import Command
'line_ids': [Command.clear(), Command.create(vals)]
```

### ‚úÖ 14. JavaScript - Migration des appels super()

**Probl√®me** : `this._super()` est d√©pr√©ci√© dans Odoo 18

```javascript
// AVANT (Odoo 17)
patch(Component.prototype, "module.Component", {
    setup() {
        this._super();
        // code
    },

    methodName(args) {
        return this._super(args);
    }
});

// APR√àS (Odoo 18)
patch(Component.prototype, "module.Component", {
    setup() {
        super.setup();
        // code
    },

    methodName(args) {
        return super.methodName(args);
    }
});
```

### ‚úÖ 15. Optimisations et bonnes pratiques

**Performance et qualit√©** :

```python
# Traduction optimis√©e
# AVANT (Odoo 17)
from odoo import _
message = _("Hello world")

# APR√àS (Odoo 18) - Performance am√©lior√©e
message = self.env._("Hello world")
```

```python
# Tests - D√©sactivation du tracking
# AVANT (Odoo 17)
class TestClass(TransactionCase):
    def test_method(self):
        # tests avec tracking activ√©

# APR√àS (Odoo 18) - Performance am√©lior√©e
class TestClass(BaseCommon):  # ou TransactionCase
    @classmethod
    def setUpClass(cls):
        super().setUpClass()
        cls.env = cls.env(context=dict(cls.env.context, tracking_disable=True))
```

```xml
<!-- Actions - Am√©lioration des URLs -->
<!-- AVANT (Odoo 17) -->
<record id="action_id" model="ir.actions.act_window">
    <field name="res_model">model.name</field>
</record>

<!-- APR√àS (Odoo 18) - URL plus propre -->
<record id="action_id" model="ir.actions.act_window">
    <field name="res_model">model.name</field>
    <field name="path">nice-url-path</field>
</record>
```

**Nettoyage des vues** :
```xml
<!-- Les champs invisibles utilis√©s dans les domaines sont auto-ajout√©s -->
<!-- AVANT (Odoo 17) -->
<field name="state" invisible="True"/>  <!-- Peut √™tre supprim√© -->
<field name="other_field" readonly="state != 'draft'"/>

<!-- APR√àS (Odoo 18) -->
<!-- field 'state' auto-ajout√©, pas besoin de le d√©clarer -->
<field name="other_field" readonly="state != 'draft'"/>
```

---
